<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css">

<meta name="hexo-config" content="{&quot;hostname&quot;:&quot;www.udnz.com&quot;,&quot;root&quot;:&quot;/&quot;,&quot;images&quot;:&quot;/images&quot;,&quot;scheme&quot;:&quot;Muse&quot;,&quot;version&quot;:&quot;8.3.0&quot;,&quot;exturl&quot;:false,&quot;sidebar&quot;:{&quot;position&quot;:&quot;right&quot;,&quot;display&quot;:&quot;post&quot;,&quot;padding&quot;:18,&quot;offset&quot;:12},&quot;copycode&quot;:true,&quot;bookmark&quot;:{&quot;enable&quot;:false,&quot;color&quot;:&quot;#222&quot;,&quot;save&quot;:&quot;auto&quot;},&quot;fancybox&quot;:false,&quot;mediumzoom&quot;:false,&quot;lazyload&quot;:false,&quot;pangu&quot;:false,&quot;comments&quot;:{&quot;style&quot;:&quot;tabs&quot;,&quot;active&quot;:null,&quot;storage&quot;:true,&quot;lazyload&quot;:false,&quot;nav&quot;:null},&quot;motion&quot;:{&quot;enable&quot;:false,&quot;async&quot;:false,&quot;transition&quot;:{&quot;post_block&quot;:&quot;fadeIn&quot;,&quot;post_header&quot;:&quot;slideDownIn&quot;,&quot;post_body&quot;:&quot;slideDownIn&quot;,&quot;coll_header&quot;:&quot;slideLeftIn&quot;,&quot;sidebar&quot;:&quot;slideUpIn&quot;}},&quot;prism&quot;:false,&quot;i18n&quot;:{&quot;placeholder&quot;:&quot;搜索...&quot;,&quot;empty&quot;:&quot;没有找到任何搜索结果：${query}&quot;,&quot;hits_time&quot;:&quot;找到 ${hits} 个搜索结果（用时 ${time} 毫秒）&quot;,&quot;hits&quot;:&quot;找到 ${hits} 个搜索结果&quot;},&quot;path&quot;:&quot;/search.xml&quot;,&quot;localsearch&quot;:{&quot;enable&quot;:true,&quot;trigger&quot;:&quot;auto&quot;,&quot;top_n_per_article&quot;:1,&quot;unescape&quot;:false,&quot;preload&quot;:false}}">
<meta name="description" content="架构师，腾讯专注微服务和软件基础设施建设">
<meta property="og:type" content="website">
<meta property="og:title" content="UDNZ">
<meta property="og:url" content="https://www.udnz.com/page/2/index.html">
<meta property="og:site_name" content="UDNZ">
<meta property="og:description" content="架构师，腾讯专注微服务和软件基础设施建设">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Austin Luo">
<meta property="article:tag" content=".net, architecture, architect, micro-service, soa, istio, k8s, kubernetes, dotnet, .net core, c#">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://www.udnz.com/page/2/">



<meta name="hexo-config-page" content="{&quot;sidebar&quot;:&quot;&quot;,&quot;isHome&quot;:true,&quot;isPost&quot;:false,&quot;lang&quot;:&quot;zh-CN&quot;}">
<meta name="hexo-config-calendar" content="">
<title>UDNZ</title><script data-pjax src="/js/load-config.js"></script>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="UDNZ" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">UDNZ</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">28</span></a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">18</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Austin Luo"
      src="https://avatars3.githubusercontent.com/u/934574?s=400&u=e82170d672ed95a22dfe72374fde752cf973b785&v=4">
  <p class="site-author-name" itemprop="name">Austin Luo</p>
  <div class="site-description" itemprop="description">架构师，腾讯<br />专注微服务和软件基础设施建设</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">18</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">28</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/uonun" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;uonun" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://bitbucket.org/uonun/" title="Bitbucket → https:&#x2F;&#x2F;bitbucket.org&#x2F;uonun&#x2F;" rel="noopener" target="_blank"><i class="fab fa-bitbucket fa-fw"></i>Bitbucket</a>
      </span>
      <span class="links-of-author-item">
        <a target="_blank" rel="noopener" href="//shang.qq.com/wpa/qunwpa?idkey=2aa3ef00102d1db4f2275d835aabf3eb043e8ba7b22ead791ba469cdb198a8cc" title="QQ 群 → &#x2F;&#x2F;shang.qq.com&#x2F;wpa&#x2F;qunwpa?idkey&#x3D;2aa3ef00102d1db4f2275d835aabf3eb043e8ba7b22ead791ba469cdb198a8cc"><i class="qq fa-fw"></i>QQ 群</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.udnz.com/2018/10/01/%E9%80%9A%E8%BF%87-SSH-%E9%9A%A7%E9%81%93%E9%93%BE%E6%8E%A5%E8%BF%9C%E7%A8%8B-MySQL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars3.githubusercontent.com/u/934574?s=400&u=e82170d672ed95a22dfe72374fde752cf973b785&v=4">
      <meta itemprop="name" content="Austin Luo">
      <meta itemprop="description" content="架构师，腾讯<br />专注微服务和软件基础设施建设">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="UDNZ">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/10/01/%E9%80%9A%E8%BF%87-SSH-%E9%9A%A7%E9%81%93%E9%93%BE%E6%8E%A5%E8%BF%9C%E7%A8%8B-MySQL/" class="post-title-link" itemprop="url">通过 SSH 隧道链接远程 MySQL</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-10-01 20:18:10" itemprop="dateCreated datePublished" datetime="2018-10-01T20:18:10+08:00">2018-10-01</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>场景：</p>
<ul>
<li>SSH 跳板机：10.0.0.1</li>
<li>MySQL 数据库：10.0.0.2:3306</li>
</ul>
<p>MySQL 部署的机器不允许 SSH 连接，并且数据库端口只允许 localhost 或 10.0.0.1 这台跳板机访问，此时本机可以通过 ssh 连上跳板机，通过 ssh 建立的隧道端口转发连接上 MySQL 数据库。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2018/10/01/%E9%80%9A%E8%BF%87-SSH-%E9%9A%A7%E9%81%93%E9%93%BE%E6%8E%A5%E8%BF%9C%E7%A8%8B-MySQL/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.udnz.com/2018/09/30/Understanding-Architecture/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars3.githubusercontent.com/u/934574?s=400&u=e82170d672ed95a22dfe72374fde752cf973b785&v=4">
      <meta itemprop="name" content="Austin Luo">
      <meta itemprop="description" content="架构师，腾讯<br />专注微服务和软件基础设施建设">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="UDNZ">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/09/30/Understanding-Architecture/" class="post-title-link" itemprop="url">Understanding Architecture</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-09-30 15:13:43" itemprop="dateCreated datePublished" datetime="2018-09-30T15:13:43+08:00">2018-09-30</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="架构是这样定义的"><a href="#架构是这样定义的" class="headerlink" title="架构是这样定义的"></a>架构是这样定义的</h1><ul>
<li>每个系统都有一个架构</li>
<li>架构由架构元素以及相互之间的关系构成</li>
<li>系统是为了满足 <strong>利益相关者（stakeholder）</strong> 的需求而构建的</li>
<li>利益相关者都有自己的<strong>关注点（concerns）</strong></li>
<li>架构由架构文档描述</li>
<li>架构文档描述了一系列的<strong>架构视角</strong></li>
<li>每个视角都解决并且对应到利益相关者的关注点。</li>
</ul>
<p>架构师的首要任务是尽最大可能找出所有利益相关者，业务方，产品经理，客户/用户，开发经理，工程师，项目经理，测试人员，运维人员，产品运营人员等等都有可能是利益相关者，架构师要充分和利益相关者沟通，深入理解他们的关注点和痛点，并出架构解决这些关注点。架构师常犯错误是漏掉重要的利益相关者，沟通不充分，都会造成架构有欠缺，不能满足利益相关者的需求。利益相关者的关注点是有可能冲突的，比如管理层（可管理性）vs技术方（性能），业务方（多快好省）vs 技术方（可靠稳定），这需要架构师去灵活平衡，如何平衡体现了架构师的水平和价值。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2018/09/30/Understanding-Architecture/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.udnz.com/2018/09/30/Kubernetes/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars3.githubusercontent.com/u/934574?s=400&u=e82170d672ed95a22dfe72374fde752cf973b785&v=4">
      <meta itemprop="name" content="Austin Luo">
      <meta itemprop="description" content="架构师，腾讯<br />专注微服务和软件基础设施建设">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="UDNZ">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/09/30/Kubernetes/" class="post-title-link" itemprop="url">Kubernetes 环境搭建</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-09-30 11:08:49" itemprop="dateCreated datePublished" datetime="2018-09-30T11:08:49+08:00">2018-09-30</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-10 18:13:32" itemprop="dateModified" datetime="2021-04-10T18:13:32+08:00">2021-04-10</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Kubernetes-环境安装"><a href="#Kubernetes-环境安装" class="headerlink" title="Kubernetes 环境安装"></a>Kubernetes 环境安装</h1><h2 id="面向生产：kubeadmin"><a href="#面向生产：kubeadmin" class="headerlink" title="面向生产：kubeadmin"></a>面向生产：kubeadmin</h2><h3 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h3><table>
<thead>
<tr>
<th>IP</th>
<th>主机名</th>
<th>用途</th>
</tr>
</thead>
<tbody><tr>
<td>192.168.1.1</td>
<td>k8s-master</td>
<td>master、etcd</td>
</tr>
<tr>
<td>192.168.1.2</td>
<td>k8s-node-1</td>
<td>node1</td>
</tr>
<tr>
<td>192.168.1.3</td>
<td>k8s-node-2</td>
<td>node2</td>
</tr>
</tbody></table>
<h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><h4 id="设置三台机器的主机名"><a href="#设置三台机器的主机名" class="headerlink" title="设置三台机器的主机名"></a>设置三台机器的主机名</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在 master 上执行</span></span><br><span class="line">hostnamectl --static set-hostname k8s-master</span><br><span class="line"><span class="comment"># 在 node1 上执行</span></span><br><span class="line">hostnamectl --static set-hostname k8s-node-1</span><br><span class="line"><span class="comment"># 在 node2 上执行</span></span><br><span class="line">hostnamectl --static set-hostname k8s-node-2</span><br></pre></td></tr></table></figure>

<h4 id="设置-hosts"><a href="#设置-hosts" class="headerlink" title="设置 hosts"></a>设置 hosts</h4><p>在三台机器上设置 hosts，均执行如下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;192.168.1.1    k8s-master</span></span><br><span class="line"><span class="string">192.168.1.1   etcd</span></span><br><span class="line"><span class="string">192.168.1.2     k8s-node-1</span></span><br><span class="line"><span class="string">192.168.1.3   k8s-node-2&#x27;</span> &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure>

<h4 id="关闭-selinux"><a href="#关闭-selinux" class="headerlink" title="关闭 selinux"></a>关闭 selinux</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">setenforce 0</span><br><span class="line">sed -i --follow-symlinks <span class="string">&#x27;s/SELINUX=enforcing/SELINUX=disabled/g&#x27;</span> /etc/sysconfig/selinux</span><br></pre></td></tr></table></figure>

<h4 id="网络配置"><a href="#网络配置" class="headerlink" title="网络配置"></a>网络配置</h4><p>master 机</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --permanent --add-port=6443/tcp</span><br><span class="line">firewall-cmd --permanent --add-port=2379-2380/tcp</span><br><span class="line">firewall-cmd --permanent --add-port=10250/tcp</span><br><span class="line">firewall-cmd --permanent --add-port=10251/tcp</span><br><span class="line">firewall-cmd --permanent --add-port=10252/tcp</span><br><span class="line">firewall-cmd --permanent --add-port=10255/tcp</span><br><span class="line">firewall-cmd --reload</span><br><span class="line">modprobe br_netfilter</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;1&#x27;</span> &gt; /proc/sys/net/bridge/bridge-nf-call-iptables</span><br><span class="line">sysctl -w net.ipv4.ip_forward=1</span><br></pre></td></tr></table></figure>

<p>node 机</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --permanent --add-port=10250/tcp</span><br><span class="line">firewall-cmd --permanent --add-port=10255/tcp</span><br><span class="line">firewall-cmd --permanent --add-port=30000-32767/tcp</span><br><span class="line">firewall-cmd --permanent --add-port=6783/tcp</span><br><span class="line">firewall-cmd  --reload</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;1&#x27;</span> &gt; /proc/sys/net/bridge/bridge-nf-call-iptables</span><br><span class="line">sysctl -w net.ipv4.ip_forward=1</span><br></pre></td></tr></table></figure>

<h3 id="安装-kubelet-kubeadm-kubectl"><a href="#安装-kubelet-kubeadm-kubectl" class="headerlink" title="安装 kubelet kubeadm kubectl"></a>安装 kubelet kubeadm kubectl</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF &gt; <span class="regexp">/etc/yum</span>.repos.d/kubernetes.repo</span><br><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes</span><br><span class="line">baseurl=https:<span class="regexp">//</span>packages.cloud.google.com<span class="regexp">/yum/</span>repos/kubernetes-el7-x86_64</span><br><span class="line">enabled=<span class="number">1</span></span><br><span class="line">gpgcheck=<span class="number">1</span></span><br><span class="line">repo_gpgcheck=<span class="number">1</span></span><br><span class="line">gpgkey=https:<span class="regexp">//</span>packages.cloud.google.com<span class="regexp">/yum/</span>doc<span class="regexp">/yum-key.gpg https:/</span><span class="regexp">/packages.cloud.google.com/yum</span><span class="regexp">/doc/</span>rpm-package-key.gpg</span><br><span class="line">exclude=kube*</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将 SELinux 设置为 permissive 模式(将其禁用)</span></span><br><span class="line">setenforce <span class="number">0</span></span><br><span class="line">sed -i <span class="string">&#x27;s/^SELINUX=enforcing$/SELINUX=permissive/&#x27;</span> <span class="regexp">/etc/</span>selinux/config</span><br><span class="line"></span><br><span class="line">yum install -y kubelet kubeadm kubectl --disableexcludes=kubernetes</span><br><span class="line"></span><br><span class="line">systemctl enable kubelet &amp;&amp; systemctl start kubelet</span><br></pre></td></tr></table></figure>

<blockquote>
<p>参考：<a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/setup/independent/install-kubeadm/#%E5%AE%89%E8%A3%85-kubeadm-kubelet-%E5%92%8C-kubectl">https://kubernetes.io/zh/docs/setup/independent/install-kubeadm/#%E5%AE%89%E8%A3%85-kubeadm-kubelet-%E5%92%8C-kubectl</a></p>
</blockquote>
<h3 id="安装-etcd-服务"><a href="#安装-etcd-服务" class="headerlink" title="安装 etcd 服务"></a>安装 etcd 服务</h3><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum <span class="keyword">install</span> -y etcd</span><br></pre></td></tr></table></figure>

<p>更改配置</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>etcd/etcd.conf</span><br></pre></td></tr></table></figure>

<h3 id="创建集群"><a href="#创建集群" class="headerlink" title="创建集群"></a>创建集群</h3><h2 id="面向试用：minikube"><a href="#面向试用：minikube" class="headerlink" title="面向试用：minikube"></a>面向试用：minikube</h2><p>指引：<a target="_blank" rel="noopener" href="https://kubernetes.io/docs/tasks/tools/install-kubectl/">https://kubernetes.io/docs/tasks/tools/install-kubectl/</a></p>
<h3 id="安装-VM-驱动"><a href="#安装-VM-驱动" class="headerlink" title="安装 VM 驱动"></a>安装 VM 驱动</h3><blockquote>
<p>腾讯云 CVM 未能启用驱动启动 minikube，安装驱动的过程可忽略。</p>
</blockquote>
<h3 id="VirtualBox"><a href="#VirtualBox" class="headerlink" title="- VirtualBox"></a>- VirtualBox</h3><blockquote>
<p>CentOS：虚拟机不支持内部 VM，未在物理机上尝试</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/yum.repos.d/</span><br><span class="line">wget http://download.virtualbox.org/virtualbox/rpm/rhel/virtualbox.repo</span><br><span class="line">yum update</span><br><span class="line"></span><br><span class="line">rpm -Uvh https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm</span><br><span class="line">yum install -y binutils gcc make patch libgomp glibc-headers glibc-devel kernel-headers kernel-devel dkms</span><br><span class="line">yum install -y VirtualBox-5.2</span><br><span class="line"></span><br><span class="line">service vboxdrv start</span><br></pre></td></tr></table></figure>

<ul>
<li><a target="_blank" rel="noopener" href="https://www.if-not-true-then-false.com/2010/install-virtualbox-with-yum-on-fedora-centos-red-hat-rhel/">https://www.if-not-true-then-false.com/2010/install-virtualbox-with-yum-on-fedora-centos-red-hat-rhel/</a></li>
<li><a target="_blank" rel="noopener" href="https://www.virtualbox.org/wiki/Linux_Downloads">https://www.virtualbox.org/wiki/Linux_Downloads</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/harry-h/p/6405433.html">https://www.cnblogs.com/harry-h/p/6405433.html</a></li>
</ul>
<blockquote>
<p>MAC 上可以直接下载安装：<a target="_blank" rel="noopener" href="https://www.virtualbox.org/wiki/Downloads">https://www.virtualbox.org/wiki/Downloads</a></p>
</blockquote>
<h3 id="KVM2"><a href="#KVM2" class="headerlink" title="- KVM2"></a>- KVM2</h3><blockquote>
<p>安装成功，但 <code>minikube start</code> 时未能尝试成功</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/kubernetes/minikube/blob/master/docs/drivers.md#kvm2-driver">https://github.com/kubernetes/minikube/blob/master/docs/drivers.md#kvm2-driver</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yum -y install libvirt-daemon-kvm qemu-kvm</span><br><span class="line"></span><br><span class="line">curl -Lo docker-machine-driver-kvm2 https://storage.googleapis.com/minikube/releases/latest/docker-machine-driver-kvm2 \</span><br><span class="line">&amp;&amp; chmod +x docker-machine-driver-kvm2 \</span><br><span class="line">&amp;&amp; sudo cp docker-machine-driver-kvm2 /usr/<span class="built_in">local</span>/bin/ \</span><br><span class="line">&amp;&amp; rm docker-machine-driver-kvm2</span><br></pre></td></tr></table></figure>

<p>附：查看虚拟机网络以及使用不同的网络启动 minikube</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum -y install libvirt virt-install bridge-utils</span><br><span class="line"><span class="comment"># 查看虚拟机网络</span></span><br><span class="line">virsh net-list --all</span><br><span class="line"><span class="comment"># 使用不同的虚拟机网络(minikube-net)</span></span><br><span class="line">minikube start --vm-driver kvm2 --kvm-network minikube-net</span><br></pre></td></tr></table></figure>

<h3 id="其他驱动"><a href="#其他驱动" class="headerlink" title="- 其他驱动"></a>- 其他驱动</h3><p>指引：<a target="_blank" rel="noopener" href="https://github.com/kubernetes/minikube/blob/master/docs/drivers.md#kvm-driver">https://github.com/kubernetes/minikube/blob/master/docs/drivers.md#kvm-driver</a></p>
<h3 id="安装-kubectl"><a href="#安装-kubectl" class="headerlink" title="安装 kubectl"></a>安装 kubectl</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CentOS</span></span><br><span class="line">cat &lt;&lt;<span class="string">EOF &gt; /etc/yum.repos.d/kubernetes.repo</span></span><br><span class="line"><span class="string">[kubernetes]</span></span><br><span class="line"><span class="string">name=Kubernetes</span></span><br><span class="line"><span class="string">baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-x86_64</span></span><br><span class="line"><span class="string">enabled=1</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">repo_gpgcheck=1</span></span><br><span class="line"><span class="string">gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">yum install -y kubectl</span><br><span class="line"></span><br><span class="line"><span class="comment"># MAC: 方式一</span></span><br><span class="line">brew install kubernetes-cli</span><br><span class="line"><span class="comment"># MAC：方式二</span></span><br><span class="line">curl -Lo kubectl http://storage.googleapis.com/kubernetes-release/release/v1.5.1/bin/darwin/amd64/kubectl &amp;&amp; chmod +x kubectl &amp;&amp; sudo mv kubectl /usr/<span class="built_in">local</span>/bin/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装校验</span></span><br><span class="line">kubectl version</span><br><span class="line"></span><br><span class="line"><span class="comment"># 确保服务已启动</span></span><br><span class="line">systemctl <span class="built_in">enable</span> kubelet.service</span><br><span class="line">systemctl start kubelet.service</span><br></pre></td></tr></table></figure>

<h3 id="安装-minikube"><a href="#安装-minikube" class="headerlink" title="安装 minikube"></a>安装 minikube</h3><p>指引：<a target="_blank" rel="noopener" href="https://github.com/kubernetes/minikube/releases">https://github.com/kubernetes/minikube/releases</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CentOS</span></span><br><span class="line">curl -Lo minikube https://storage.googleapis.com/minikube/releases/v0.29.0/minikube-linux-amd64 \</span><br><span class="line">    &amp;&amp; chmod +x minikube \</span><br><span class="line">    &amp;&amp; sudo cp minikube /usr/<span class="built_in">local</span>/bin/ \</span><br><span class="line">    &amp;&amp; rm minikube</span><br><span class="line"></span><br><span class="line"><span class="comment"># MAC</span></span><br><span class="line">brew cask install minikube</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h3><p><strong>（使用 KVM2 驱动）运行之前</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动服务</span></span><br><span class="line">systemctl <span class="built_in">enable</span> libvirtd &amp;&amp; systemctl start libvirtd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看进程文件</span></span><br><span class="line">ls -l /var/run/libvirt/libvirt-sock</span><br><span class="line"></span><br><span class="line"><span class="comment"># 若进程文件不存在，则修改配置：</span></span><br><span class="line">vi /etc/libvirt/libvirtd.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 取消行前注释，重新启动服务</span></span><br><span class="line"><span class="comment">#unix_sock_dir = &quot;/var/run/libvirt&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="拉取-k8s-相关镜像"><a href="#拉取-k8s-相关镜像" class="headerlink" title="拉取 k8s 相关镜像"></a>拉取 k8s 相关镜像</h3><p>原本在 <code>minikube start</code> 命令中会自动拉取镜像，但是因为众所周知的原因，我们无法成功拉取到镜像。这里可以使用阿里 docker 容器镜像服务：<a target="_blank" rel="noopener" href="https://dev.aliyun.com/search.html">https://dev.aliyun.com/search.html</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入虚拟机拉取，而非本机</span></span><br><span class="line">minikube ssh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 拉取镜像</span></span><br><span class="line">docker pull registry.cn-hangzhou.aliyuncs.com/k8sth/kube-apiserver-amd64:v1.10.0</span><br><span class="line">docker pull registry.cn-hangzhou.aliyuncs.com/k8sth/kube-controller-manager-amd64:v1.10.0</span><br><span class="line">docker pull registry.cn-hangzhou.aliyuncs.com/k8sth/kube-scheduler-amd64:v1.10.0</span><br><span class="line">docker pull registry.cn-hangzhou.aliyuncs.com/k8sth/etcd-amd64:3.1.12</span><br><span class="line">docker pull registry.cn-shenzhen.aliyuncs.com/kubernetes_google/kubernetes-dashboard-amd64:v1.10.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改 tag</span></span><br><span class="line">docker tag registry.cn-hangzhou.aliyuncs.com/k8sth/kube-apiserver-amd64:v1.10.0 k8s.gcr.io/kube-apiserver-amd64:v1.10.0</span><br><span class="line">docker tag registry.cn-hangzhou.aliyuncs.com/k8sth/kube-controller-manager-amd64:v1.10.0 k8s.gcr.io/kube-controller-manager-amd64:v1.10.0</span><br><span class="line">docker tag registry.cn-hangzhou.aliyuncs.com/k8sth/kube-scheduler-amd64:v1.10.0 k8s.gcr.io/kube-scheduler-amd64:v1.10.0</span><br><span class="line">docker tag registry.cn-hangzhou.aliyuncs.com/k8sth/etcd-amd64:3.1.12 k8s.gcr.io/etcd-amd64:3.1.12</span><br><span class="line">docker tag registry.cn-shenzhen.aliyuncs.com/kubernetes_google/kubernetes-dashboard-amd64:v1.10.0 k8s.gcr.io/kubernetes-dashboard-amd64:v1.10.0</span><br></pre></td></tr></table></figure>

<h3 id="启动-Kubenetes"><a href="#启动-Kubenetes" class="headerlink" title="启动 Kubenetes"></a>启动 Kubenetes</h3><p>指引：<a target="_blank" rel="noopener" href="https://kubernetes.io/docs/setup/minikube/#quickstart">https://kubernetes.io/docs/setup/minikube/#quickstart</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在代理下运行时，需要指定正确的代理，否则 minikube 在内部访问网络会有问题</span></span><br><span class="line"><span class="comment"># 注意，代理地址应当是在虚拟机中能够访问的地址，不能使用 127.0.0.1、localhost 这种</span></span><br><span class="line">https_proxy=http://myproxy.com:8080</span><br><span class="line">minikube start \</span><br><span class="line">    --docker-env http_proxy=http://myproxy.com:8080 \</span><br><span class="line">    --docker-env https_proxy=http://myproxy.com:8080 \</span><br><span class="line">    --docker-env no_proxy=192.168.99.0/24</span><br><span class="line">    --vm-driver=none</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装和启动过程中可能产生错误，通过该命令查看日志</span></span><br><span class="line">minikube logs -f</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动 k8s（ CentOS 上不使用任何 vm 驱动，MAC 上默认可使用 VirtualBox）</span></span><br><span class="line">minikube start \</span><br><span class="line">    --network-plugin=cni \</span><br><span class="line">    --container-runtime=containerd \</span><br><span class="line">    --bootstrapper=kubeadm</span><br><span class="line">    --vm-driver=none</span><br><span class="line"></span><br><span class="line"><span class="comment"># Dashboard</span></span><br><span class="line"><span class="comment"># https://github.com/kubernetes/dashboard</span></span><br><span class="line">kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/master/src/deploy/recommended/kubernetes-dashboard.yaml</span><br><span class="line">kubectl proxy</span><br><span class="line"></span><br><span class="line"><span class="comment"># 部署及运行镜像</span></span><br><span class="line">kubectl run hello-minikube --image=registry.cn-hangzhou.aliyuncs.com/acs/echoserver:1.4 --port=8080</span><br><span class="line"></span><br><span class="line"><span class="comment"># 导出服务</span></span><br><span class="line">kubectl expose deployment hello-minikube --<span class="built_in">type</span>=NodePort</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询 Pod</span></span><br><span class="line">kubectl get pod</span><br><span class="line">kubectl get pods --all-namespaces</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看状态</span></span><br><span class="line">kubectl describe --namespace=kube-system po kubernetes-dashboard-6f4cfc5d87-d647l</span><br><span class="line">kubectl logs kubernetes-dashboard-6f4cfc5d87-x976v --namespace=kube-system</span><br><span class="line">kubectl cluster-info</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用服务</span></span><br><span class="line">curl $(minikube service hello-minikube --url)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除服务</span></span><br><span class="line">kubectl delete services hello-minikube</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除部署</span></span><br><span class="line">kubectl delete deployment hello-minikube</span><br><span class="line"></span><br><span class="line"><span class="comment"># 停止 k8s</span></span><br><span class="line">minikube stop</span><br></pre></td></tr></table></figure>

<h3 id="向-kubernetes-添加账号"><a href="#向-kubernetes-添加账号" class="headerlink" title="向 kubernetes 添加账号"></a>向 kubernetes 添加账号</h3><p><a target="_blank" rel="noopener" href="https://github.com/kubernetes/dashboard/wiki/Creating-sample-user">https://github.com/kubernetes/dashboard/wiki/Creating-sample-user</a></p>
<h2 id="相关问题"><a href="#相关问题" class="headerlink" title="相关问题"></a>相关问题</h2><h3 id="failed-to-create-kubelet-misconfiguration-kubelet-cgroup-driver-“cgroupfs”-is-different-from-docker-cgr…driver-“systemd”"><a href="#failed-to-create-kubelet-misconfiguration-kubelet-cgroup-driver-“cgroupfs”-is-different-from-docker-cgr…driver-“systemd”" class="headerlink" title="failed to create kubelet: misconfiguration: kubelet cgroup driver: “cgroupfs” is different from docker cgr…driver: “systemd”"></a>failed to create kubelet: misconfiguration: kubelet cgroup driver: “cgroupfs” is different from docker cgr…driver: “systemd”</h3><p>该问题因为 docker 的配置和 kubelet 的配置不一致导致。</p>
<p>使用 docker info 打印 docker 信息：</p>
<figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_0_16_centos kubelet.service.d]# docker info | grep Driver</span><br><span class="line"> <span class="literal">WARNING</span>: Usage <span class="keyword">of</span> loopback devices <span class="keyword">is</span> strongly discouraged <span class="keyword">for</span> production <span class="keyword">use</span>. <span class="keyword">Use</span> `<span class="comment">--storage-opt dm.thinpooldev` to specify a custom block storage device.</span></span><br><span class="line">  <span class="literal">WARNING</span>: You<span class="symbol">&#x27;re</span> <span class="keyword">not</span> using the <span class="keyword">default</span> seccomp profile</span><br><span class="line">Storage Driver: devicemapper</span><br><span class="line">Logging Driver: journald</span><br><span class="line">Cgroup Driver: systemd</span><br></pre></td></tr></table></figure>

<p>而查看 kubelet 服务的启动参数（<code>--cgroup-driver</code>），其设置为 <code>cgroupfs</code>：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_0_16_centos kubelet.service.d]# more /etc/systemd/system/kubelet.service.d/10-kubeadm.conf</span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line"><span class="attribute">Wants</span>=docker.socket</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStart=</span><br><span class="line"><span class="attribute">ExecStart</span>=/usr/bin/kubelet <span class="attribute">--hostname-override</span>=minikube <span class="attribute">--cluster-domain</span>=cluster.local <span class="attribute">--cgroup-driver</span>=cgroupfs <span class="attribute">--authorization-mode</span>=Webhook <span class="attribute">--client-ca-file</span>=/var/lib/minikube/certs/ca.crt <span class="attribute">--fail-swap-on</span>=<span class="literal">false</span> <span class="attribute">--kubeconfig</span>=/etc/kubernetes/ku</span><br><span class="line">belet.conf <span class="attribute">--bootstrap-kubeconfig</span>=/etc/kubernetes/bootstrap-kubelet.conf <span class="attribute">--pod-manifest-path</span>=/etc/kubernetes/manifests <span class="attribute">--allow-privileged</span>=<span class="literal">true</span> <span class="attribute">--cluster-dns</span>=10.96.0.10 <span class="attribute">--cadvisor-port</span>=0</span><br><span class="line"></span><br><span class="line">[Install]</span><br></pre></td></tr></table></figure>

<p>此时，修改 docker 的服务参数（<code>vi /usr/lib/systemd/system/docker.service</code>），将其中的 <code>--exec-opt native.cgroupdriver</code> 参数值改为 <code>cgroupfs</code> 。</p>
<p>然后，重启 docker，重启 kubelet</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload &amp;&amp; systemctl restart docker &amp;&amp; systemctl restart kubelet</span><br></pre></td></tr></table></figure>

<h3 id="ERROR-FileContent–proc-sys-net-bridge-bridge-nf-call-iptables-proc-sys-net-bridge-bridge-nf-call-iptables-contents-are-not-set-to-1"><a href="#ERROR-FileContent–proc-sys-net-bridge-bridge-nf-call-iptables-proc-sys-net-bridge-bridge-nf-call-iptables-contents-are-not-set-to-1" class="headerlink" title="[ERROR FileContent–proc-sys-net-bridge-bridge-nf-call-iptables]: /proc/sys/net/bridge/bridge-nf-call-iptables contents are not set to 1"></a>[ERROR FileContent–proc-sys-net-bridge-bridge-nf-call-iptables]: /proc/sys/net/bridge/bridge-nf-call-iptables contents are not set to 1</h3><p>解决方案：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> 1 &gt; /proc/sys/net/bridge/bridge-nf-call-iptables</span><br><span class="line"><span class="built_in">echo</span> 1 &gt; /proc/sys/net/bridge/bridge-nf-call-ip6tables</span><br></pre></td></tr></table></figure>

<h3 id="Unable-to-update-cni-config-No-networks-found-in-etc-cni-net-d"><a href="#Unable-to-update-cni-config-No-networks-found-in-etc-cni-net-d" class="headerlink" title="Unable to update cni config: No networks found in /etc/cni/net.d"></a>Unable to update cni config: No networks found in /etc/cni/net.d</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y kubernetes-cni</span><br></pre></td></tr></table></figure>

<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/a42eeb66a19c">https://www.jianshu.com/p/a42eeb66a19c</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.udnz.com/2018/06/15/%E8%AE%B0%E4%B8%80%E6%AC%A1-NET-Framework-%E4%B8%8D%E5%85%BC%E5%AE%B9-HTTP-COOKIE-%E5%8D%8F%E8%AE%AE%E6%A0%87%E5%87%86%E7%9A%84%E9%97%AE%E9%A2%98%E8%B7%9F%E8%B8%AA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars3.githubusercontent.com/u/934574?s=400&u=e82170d672ed95a22dfe72374fde752cf973b785&v=4">
      <meta itemprop="name" content="Austin Luo">
      <meta itemprop="description" content="架构师，腾讯<br />专注微服务和软件基础设施建设">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="UDNZ">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/06/15/%E8%AE%B0%E4%B8%80%E6%AC%A1-NET-Framework-%E4%B8%8D%E5%85%BC%E5%AE%B9-HTTP-COOKIE-%E5%8D%8F%E8%AE%AE%E6%A0%87%E5%87%86%E7%9A%84%E9%97%AE%E9%A2%98%E8%B7%9F%E8%B8%AA/" class="post-title-link" itemprop="url">记一次 .NET Framework 不兼容 HTTP COOKIE 协议标准的问题跟踪</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-06-15 16:48:16" itemprop="dateCreated datePublished" datetime="2018-06-15T16:48:16+08:00">2018-06-15</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>我们在后端系统实现了 HTTP 请求的代理类，用于请求其他第三方系统。大致的请求流程是这样的：</p>
<p>![](/images/记一次 .NET Framework 不兼容 HTTP COOKIE 协议标准的问题跟踪-1.png)</p>
<p>消费系统不能直接请求业务系统的 HTTP 接口，需要由中间的 HttpHelper 代理请求。其中 HttpHelper 接受消费系统传入的各种参数，包括要请求的 URL、METHOD、HEAD、BODY 等，在实际生产中一直运行得很好，直到如下异常的出现：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">System.Net.CookieException: Cookie format error.</span><br><span class="line">   at System.Net.CookieContainer.CookieCutter(Uri uri, String headerName, String setCookieHeader, Boolean isThrow)</span><br></pre></td></tr></table></figure>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2018/06/15/%E8%AE%B0%E4%B8%80%E6%AC%A1-NET-Framework-%E4%B8%8D%E5%85%BC%E5%AE%B9-HTTP-COOKIE-%E5%8D%8F%E8%AE%AE%E6%A0%87%E5%87%86%E7%9A%84%E9%97%AE%E9%A2%98%E8%B7%9F%E8%B8%AA/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.udnz.com/2018/02/28/%E8%BD%AF%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%9A%84%E9%BB%91%E5%8C%A3%E5%AD%90%EF%BC%9A%E6%88%91%E4%BB%AC%E8%A6%81%E6%80%8E%E6%A0%B7%E5%86%99%E6%97%A5%E5%BF%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars3.githubusercontent.com/u/934574?s=400&u=e82170d672ed95a22dfe72374fde752cf973b785&v=4">
      <meta itemprop="name" content="Austin Luo">
      <meta itemprop="description" content="架构师，腾讯<br />专注微服务和软件基础设施建设">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="UDNZ">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/02/28/%E8%BD%AF%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%9A%84%E9%BB%91%E5%8C%A3%E5%AD%90%EF%BC%9A%E6%88%91%E4%BB%AC%E8%A6%81%E6%80%8E%E6%A0%B7%E5%86%99%E6%97%A5%E5%BF%97/" class="post-title-link" itemprop="url">软件系统的黑匣子：我们要怎样写日志</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-02-28 15:28:22" itemprop="dateCreated datePublished" datetime="2018-02-28T15:28:22+08:00">2018-02-28</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h1><p>作为一个软件系统，需要写日志，这是不言而喻的，这是大家都会不假思索地说“那当然”的事。不论是什么语言，写日志的专用框架也不一而足，写到文本的，写到数据库的，写到队列的，写到Redis的等等等等。对于日志的几个级别，Trace、Debug、Warning、Error、Fault，大家也能够如数家珍。但是，有多少人能够回答下面这几个问题呢？</p>
<p>为什么需要写日志？<br>什么时候写日志？<br>日志是写给谁看的？<br>日志里都要写什么？<br>日志的组织形式应该怎样？</p>
<p>接下来，我尝试一一地解答这些问题，说说我的理解。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2018/02/28/%E8%BD%AF%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%9A%84%E9%BB%91%E5%8C%A3%E5%AD%90%EF%BC%9A%E6%88%91%E4%BB%AC%E8%A6%81%E6%80%8E%E6%A0%B7%E5%86%99%E6%97%A5%E5%BF%97/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.udnz.com/2017/11/15/%E5%88%9B%E5%BB%BA-VS-2017-%E7%9A%84%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%E5%8C%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars3.githubusercontent.com/u/934574?s=400&u=e82170d672ed95a22dfe72374fde752cf973b785&v=4">
      <meta itemprop="name" content="Austin Luo">
      <meta itemprop="description" content="架构师，腾讯<br />专注微服务和软件基础设施建设">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="UDNZ">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/11/15/%E5%88%9B%E5%BB%BA-VS-2017-%E7%9A%84%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%E5%8C%85/" class="post-title-link" itemprop="url">创建 VS 2017 的离线安装包</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-15 16:03:02" itemprop="dateCreated datePublished" datetime="2017-11-15T16:03:02+08:00">2017-11-15</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>以下以 VS 的编译工具包为例，实际上 VS IDE 本身也可以如此进行。</p>
<h1 id="一、下载在线安装文件"><a href="#一、下载在线安装文件" class="headerlink" title="一、下载在线安装文件"></a>一、下载在线安装文件</h1><ol>
<li>进入下载页：<a target="_blank" rel="noopener" href="https://www.visualstudio.com/zh-hans/downloads/">https://www.visualstudio.com/zh-hans/downloads/</a></li>
<li>选择最底部的 <code>Other Tools and Frameworks</code> -&gt; <code>Visual Studio 2017</code> 生成工具 并下载。</li>
<li>以管理员身份运行刚刚下载的在线安装文件，注意带参数：<code>--layout &quot;F:\software\VS2017 BuildTool\Offline&quot; --lang zh-CN</code></li>
</ol>
<p>![](/images/创建 VS 2017 的离线安装包-1.png)</p>
<p>此时将开始下载安装所需文件：（如果断电断网或者关闭了下载窗口，没关系，输入命令重头来过，还是会继续下载的）</p>
<p>![](/images/创建 VS 2017 的离线安装包-2.png)</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2017/11/15/%E5%88%9B%E5%BB%BA-VS-2017-%E7%9A%84%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%E5%8C%85/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.udnz.com/2017/04/21/%E4%BB%80%E4%B9%88%E6%98%AF%E5%86%99%E7%A8%8B%E5%BA%8F%E7%9A%84%E5%BF%AB%E6%84%9F%EF%BC%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars3.githubusercontent.com/u/934574?s=400&u=e82170d672ed95a22dfe72374fde752cf973b785&v=4">
      <meta itemprop="name" content="Austin Luo">
      <meta itemprop="description" content="架构师，腾讯<br />专注微服务和软件基础设施建设">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="UDNZ">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/04/21/%E4%BB%80%E4%B9%88%E6%98%AF%E5%86%99%E7%A8%8B%E5%BA%8F%E7%9A%84%E5%BF%AB%E6%84%9F%EF%BC%9F/" class="post-title-link" itemprop="url">什么是写程序的快感？</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-04-21 13:25:28" itemprop="dateCreated datePublished" datetime="2017-04-21T13:25:28+08:00">2017-04-21</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>初中时，在电视里看office学习节目，对电脑无比神往。高二时，第一次开电脑上机课，两个人一台机学开机关机等基本操作，激动得大腿肌肉颤抖，在凳子上坐不住，坐两分钟蹲几分钟马步，实在会发抖，过了十几分钟才坐的住。这就是快感。</p>
<p>大学时，左边放着个水杯，码一阵代码后开启调试的间歇喝一口水，结果杯里的水喝完了，举着空杯喝一口空气。杯子放下继续码代码，直到第二次…第N次举着空水杯喝空气之后，仍然没有去把杯子续上，然而续水很远吗？不，水壶就在右手边。这就是快感。</p>
<p>临毕业，自己写一个博客程序，生生推倒重写3次，每一次都是质变。期间一个结构设计问题思考酝酿了很久，最终是半夜做梦突然来了灵感醒来，兴奋的再也睡不着了，马上一个激灵起来实现。整个博客程序完成之后无意看到了head first设计模式，各种我操我操的感叹，尼玛怎么跟我想的一样？这就是快感。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2017/04/21/%E4%BB%80%E4%B9%88%E6%98%AF%E5%86%99%E7%A8%8B%E5%BA%8F%E7%9A%84%E5%BF%AB%E6%84%9F%EF%BC%9F/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.udnz.com/2017/03/23/%E5%90%8E%E7%AB%AF%E8%A7%86%E8%A7%92%E7%9A%84%E9%AB%98%E6%80%A7%E8%83%BD%E3%80%81%E9%AB%98%E5%8F%AF%E7%94%A8%E8%AE%BE%E8%AE%A1%E6%A6%82%E8%A6%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars3.githubusercontent.com/u/934574?s=400&u=e82170d672ed95a22dfe72374fde752cf973b785&v=4">
      <meta itemprop="name" content="Austin Luo">
      <meta itemprop="description" content="架构师，腾讯<br />专注微服务和软件基础设施建设">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="UDNZ">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/03/23/%E5%90%8E%E7%AB%AF%E8%A7%86%E8%A7%92%E7%9A%84%E9%AB%98%E6%80%A7%E8%83%BD%E3%80%81%E9%AB%98%E5%8F%AF%E7%94%A8%E8%AE%BE%E8%AE%A1%E6%A6%82%E8%A6%81/" class="post-title-link" itemprop="url">后端视角的高性能、高可用设计概要</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-03-23 10:31:28" itemprop="dateCreated datePublished" datetime="2017-03-23T10:31:28+08:00">2017-03-23</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="高性能"><a href="#高性能" class="headerlink" title="高性能"></a>高性能</h1><h2 id="业务方面"><a href="#业务方面" class="headerlink" title="业务方面"></a>业务方面</h2><ul>
<li>将同步业务转化为异步业务</li>
<li>业务分级，柔性可用</li>
<li>减少不必要的数据库请求</li>
<li>业务解耦，降低关联性</li>
</ul>
<h2 id="应用方面"><a href="#应用方面" class="headerlink" title="应用方面"></a>应用方面</h2><ul>
<li>前端高性能设计（略）</li>
<li>使用缓存：多级缓存、分布式缓存</li>
<li>预加载、懒加载、延迟初始化</li>
<li>尽量减小交互接口数据包大小</li>
<li>尽量减少序列化、对象克隆</li>
<li>尽量减少跨进程、跨机器、跨网络访问</li>
<li>尽量减少在同步业务中使用事务</li>
<li>尽量减少锁的使用<ul>
<li>使用乐观锁</li>
<li>尽量缩小锁的范围</li>
<li>尽量将低性能逻辑放到锁的范围之外</li>
</ul>
</li>
<li>使用异步逻辑</li>
<li>队列削峰，先接受，后处理</li>
<li>尽量复用<ul>
<li>线程：线程池</li>
<li>连接：长连接、连接池</li>
</ul>
</li>
</ul>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2017/03/23/%E5%90%8E%E7%AB%AF%E8%A7%86%E8%A7%92%E7%9A%84%E9%AB%98%E6%80%A7%E8%83%BD%E3%80%81%E9%AB%98%E5%8F%AF%E7%94%A8%E8%AE%BE%E8%AE%A1%E6%A6%82%E8%A6%81/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>
<script src="/js/comments.js"></script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2015 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">udnz.com</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  
<script src="/js/local-search.js"></script>






  





</body>
</html>
